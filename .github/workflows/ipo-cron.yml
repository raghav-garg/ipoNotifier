name: Daily Digest Cron

# =========================================================
# TRIGGERS
# =========================================================

on:

  # -----------------------------------
  # Daily Scheduled Run
  # 12:15 PM IST = 06:45 UTC
  # -----------------------------------
  schedule:
    - cron: "45 6 * * *"

  # -----------------------------------
  # Manual Run Button
  # -----------------------------------
  workflow_dispatch:


# =========================================================
# JOBS
# =========================================================

jobs:

  run-daily-digest:

    runs-on: ubuntu-latest

    steps:

      # -----------------------------------
      # Step 1 — Checkout Repository
      # -----------------------------------
      - name: Checkout Repository
        uses: actions/checkout@v3


      # -----------------------------------
      # Step 2 — Setup Python
      # -----------------------------------
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"


      # -----------------------------------
      # Step 3 — Install Dependencies
      # -----------------------------------
      - name: Install Requirements
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt


      # -----------------------------------
      # Step 4 — Run Digest Script
      # -----------------------------------
      - name: Execute Daily Digest
        run: |
          python main_digest.py
        env:
          EMAIL_USER: ${{ secrets.EMAIL_USER }}
          EMAIL_PASS: ${{ secrets.EMAIL_PASS }}
          EMAIL_TO: ${{ secrets.EMAIL_TO }}
          GOOGLE_CREDS_JSON: ${{ secrets.GOOGLE_CREDS_JSON }}
